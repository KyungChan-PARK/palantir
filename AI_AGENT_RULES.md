# AI Agent Contribution Rules

본 문서는 GPT-4.1 등 AI 에이전트가 본 레포지토리에 기여할 때 따라야 할 지침을 정의합니다.

## 1. 일반 원칙
1. **테스트 우선**: 모든 새로운 기능은 `tests/`에 단위 테스트를 작성하고, 커버리지 90% 이상을 유지합니다.
2. **문서화 동반**: 기능 추가 또는 변경 시 반드시 관련 문서(README, PRD, API_REFERENCE 등)를 업데이트합니다.
3. **외부 호출 최소화**: `OFFLINE_MODE=True`일 때 외부 네트워크 호출을 시도하지 않습니다.
4. **시크릿 금지**: 코드에 API 키, 패스워드 등 민감 정보 하드코딩을 금지합니다. 환경 변수 또는 `core/config.py` 설정을 사용하세요.
5. **표준 스타일 준수**: `ruff`, `black` 포맷에 통과해야 하며, `self_improve.py`의 품질 게이트를 통과해야 합니다.

## 2. 아키텍처 규칙
- FastAPI 라우터는 경량 컨트롤러로 유지하고, 비즈니스 로직은 `palantir/core/` 하위 모듈에 위치합니다.
- 외부 서비스(Weaviate, Neo4j 등) 호출 로직은 전용 헬퍼/클라이언트 모듈을 통해 추상화합니다.
- LLM 제공자 로직은 `LLMManager`에 캡슐화하며, 새로운 공급자를 추가할 때 기존 인터페이스를 유지합니다.

## 3. 보안 & 정책 가드
- 모든 변경 사항은 `policy_guard`의 인증·요율 제한·캐싱 체계를 훼손하지 않아야 합니다.
- AI가 생성한 코드 중 `exec`, `eval`, 시스템 명령 호출은 가능한 피하며, 불가피할 경우 사전 검증 로직을 포함합니다.

## 4. 작업 프로세스
1. **PRD 작성 → RFC 작성 → 구현** 순서를 따릅니다.
2. 큰 변경은 `docs/`에 RFC를 추가하고 휴먼 리뷰를 거칩니다.
3. 코드 제출 전 `pytest`, `ruff`, `black --check`를 로컬에서 실행하여 오류가 없는지 확인합니다.

## 5. 금지 사항
- 테스트 없는 프로덕션 코드 추가
- 인터넷이 필요한 기능을 offline 기본 경로에 묶어두지 않음
- 장기 실행 블로킹 I/O를 FastAPI sync 핸들러에 직접 작성

이 규칙은 필요 시 업데이트될 수 있으며, AI 에이전트는 항상 최신 버전을 읽고 준수해야 합니다. 