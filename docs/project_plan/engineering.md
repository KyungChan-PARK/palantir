이제 Claude-Sonnet-3.5 모델이 Cursor 등에서 독립 파일로 실행할 수 있도록 전문 형태의 작업지시서를 총 6개 마크다운 파일로 분리해 작성하겠습니다. 각 지시서는 예시가 아닌 완성된 명령 형식으로 구성되며, 외부 참고가 필요한 경우 명확한 GitHub, Reddit, 블로그 링크를 명시합니다.

또한 현재 GitHub 리포지토리의 의존성 문제 및 설치 오류 가능성을 검토한 후, 가장 먼저 실행해야 할 '환경 구성 및 의존성 설치 검증' 작업지시서를 별도 작성하여 Claude가 정확히 시작할 수 있도록 안내하겠습니다. 이 과정이 완료되면 전체 작업지시서와 구조를 정리하여 전달드리겠습니다.


## 05\_prompt\_engineering.md

# 5. 맥락 제공 및 프롬프트 엔지니어링 최적화

**목적 및 개요:** AI 코딩 도구 (Cursor 등 에디터 내 AI)가 팔란티어 코드베이스에서 **최적의 성능**을 발휘하도록, 프롬프트 방식과 컨텍스트 제공 방법을 개선합니다. 유튜브 개발자 *IndyDevDan*이 강조한 원칙처럼, **프로젝트의 시스템 개요**나 **모듈 간 인터페이스 정보**를 AI에게 먼저 제공하고, 그 위에 구체적인 작업 지시를 하는 것이 효과적입니다. 또한 한 번에 모호하고 방대한 요구사항을 주는 대신, 작업을 작은 단계로 쪼개 **연쇄 프롬프트 (prompt chaining)** 방식으로 명령을 내리는 전략을 채택합니다. 이를 통해 AI가 프로젝트의 맥락을 충분히 이해하면서 일관성 있는 출력을 내도록 하고, 사람은 중간 결과를 검토하여 \*\*휴먼의 통제권 (Human in the Loop)\*\*을 유지하는 개발 프로세스를 확립합니다.

**전체 실행 절차:**

1. **시스템 개요 맥락 문서 제공:** AI에게 코드를 생성하거나 수정하도록 요청할 때, **사전 맥락**으로 팔란티어 시스템의 구조와 주요 컴포넌트를 요약한 문서를 먼저 제공합니다.

   * 예를 들어 "우리 시스템은 FastAPI 기반 백엔드와 Tesseract OCR 모듈로 구성되며, JWT 인증과 Pinecone 벡터DB를 사용한다" 등의 아키텍처 요약 정보를 매 세션 시작 시 AI에게 주입합니다.
   * 이를 위해 `docs/architecture/overview.md` 같은 파일을 만들어 주요 모듈과 기능을 정리하고, Cursor AI 사용 시 해당 파일을 통째로 넣어주거나 프롬프트의 시스템 메시지로 이 내용을 전달합니다.
   * 이렇게 하면 AI가 코딩을 할 때 **현재 프로젝트의 전반적인 맥락**을 이해한 상태에서 작업하므로, 구조에 어긋나는 제안을 할 가능성을 줄입니다. (Palantir같이 복잡한 시스템에서는 맥락 이해가 특히 중요합니다.)

2. **표준 프롬프트 템플릿 구축:** 자주 발생하는 작업 유형별로 **프롬프트 템플릿**을 만들어 둡니다. 이를테면 *새로운 API 엔드포인트 추가*, *버그 수정*, *리팩토링*, *성능 개선* 등 시나리오별로, AI에게 줄 지시의 서식을 미리 정형화합니다.

   * 예를 들어 "신규 API 엔드포인트 구현" 템플릿에는 시스템 맥락 (위에서 언급한 개요), 관련 모듈/모델 설명, 요구 기능, 입력/출력 형식, 유의사항 등을 항목별로 채워넣는 방식입니다. 아래는 간단한 예시 템플릿입니다:

     ```text
     [시스템 맥락]
     - Framework: FastAPI (Python)
     - Auth: JWT Bearer token
     - Database: PostgreSQL via SQLAlchemy

     [요청]
     새로운 API 엔드포인트 `{endpoint}` 를 구현하시오.

     [상세 요구사항]
     - HTTP 메소드: {method}
     - 설명: {description}
     - 입력 파라미터: {params}
     - 출력: {output}
     - 기타: {other_requirements}
     ```

     AI에게 위 템플릿을 채운 상태로 제공하고 마지막에 "위 요구사항에 따라 코드를 작성하라"라고 하면, 일관성 있고 요구조건을 충실히 반영한 코드를 생성할 확률이 높아집니다. 템플릿은 프로젝트 진행 중 계속 개선하며, 필요한 항목을 추가할 수 있습니다 (예: 성능/보안상의 주의점 등).

3. **단계별 프롬프트 체이닝:** 큰 작업을 한꺼번에 맡기지 말고, **계획 → 구현 → 검증** 등의 단계로 나누어 여러 차례에 걸쳐 AI에게 요청합니다.

   * 예를 들어 "모듈 X 리팩토링" 작업의 경우:

     1. "모듈 X의 문제점과 개선 계획을 단계별로 세워줘" → (AI가 계획을 제시하면)
     2. "좋아요. 그 계획 1단계부터 코드를 수정하세요" → (AI가 코드 수정안을 주면)
     3. "수정된 코드에 대한 단위 테스트를 작성하세요"
        이렇게 **세 단계**로 나누어 각각 프롬프트를 보냅니다.
   * 개발자는 각 단계 AI 응답을 검토하여 이상 없으면 다음 단계로 넘어가고, 만약 첫 단계 응답이 부실하면 "계획에 X도 고려해주세요"라고 피드백을 준 뒤 다시 받습니다. 이처럼 iterative하게 진행하면 한번에 모든 것을 시키는 것보다 **오류를 줄이고 제어권을 유지**하기 쉽습니다.

4. **AI 출력 검증 및 인간 개입:** 항상 AI가 만들어준 결과물을 **검증하는 절차**를 포함시킵니다. 프롬프트에도 "반드시 테스트를 통과해야 한다", "취약점이 없는지 점검하라" 등의 요구사항을 넣지만, 추가로 사람이나 별도 검증 에이전트가 결과를 리뷰하게 합니다.

   * 예를 들어, Claude 등을 활용해 생성된 코드에 대해 **코드 리뷰 에이전트**가 스타일이나 보안 문제를 지적하도록 한 뒤, 인간 개발자가 최종 확인합니다. 또는 간단히, AI가 생성한 PR에 대해 동료 개발자 코드 리뷰 프로세스를 거치게 합니다 (자동화할 수 있다면 ChatGPT 등을 이용한 1차 리뷰도 고려).
   * **Human in the Loop** 원칙을 철저히 지켜, 특히 중요한 부분(인증/보안/데이터 삭제 등)은 반드시 사람이 점검 후 넘어가게 합니다. 이러한 문화를 팀에 공유해 AI 산출물을 맹신하지 않도록 교육합니다.

5. **편견 및 금지사항 관리:** 프롬프트 엔지니어링 시, 팔란티어와 같은 기업 맥락에서는 **금지어나 편향 제거**도 중요합니다. 필요하다면 시스템 프롬프트에 "팔란티어의 기업 규칙에 따라 인종/성별 편향적인 표현을 하지 말고, 고객 데이터는 가명 처리하라" 등의 지침을 넣습니다. 또한 **토큰 제한**으로 인해 긴 파일 맥락을 모두 넣지 못하는 경우, 요약본을 제공하거나 chunk 단위로 나눠 처리하는 방식을 프롬프트 디자인에 반영합니다.

### 📄 예시: 프롬프트 템플릿 활용 및 프롬프트 체이닝

다음은 위 지침을 구현하는 몇 가지 코드/스크립트 조각 예시입니다.

```python
# prompt_templates.py - Managing prompt templates for common tasks

# 1. 프롬프트 템플릿 정의 (간단히 파이썬 f-string 활용)
api_prompt_template = """\
[시스템 맥락]
- Framework: FastAPI (Python)
- Auth: JWT Bearer token
- Database: PostgreSQL via SQLAlchemy

[요청]
새로운 API 엔드포인트 `{endpoint}` 를 구현하시오.

[상세 요구사항]
- HTTP 메소드: {method}
- 설명: {description}
- 입력 파라미터: {params}
- 출력: {output}
- 기타: {other_requirements}
"""

# 2. 특정 작업에 대한 프롬프트 생성 함수
def create_api_prompt(endpoint: str):
    return api_prompt_template.format(
        endpoint=endpoint,
        method="GET",
        description="주어진 키워드로 Item을 검색",
        params="query parameter 'keyword'",
        output="Item 목록 (JSON)",
        other_requirements="인증 불필요 (public API). 오류 시 404 반환."
    )

# 3. 연쇄 프롬프트 실행 예시 (의사코드 형태, 실제로는 AI API 호출)
def chain_prompts_for_refactoring():
    # Step 1: 리팩토링 계획 수립
    plan_request = "모듈 X를 리팩토링하려고 합니다. 주요 문제점과 세부 수정 계획을 단계별로 알려주세요."
    plan_response = "답변) 1. 함수 A와 B 중복 -> 통합 ...\n2. 변수명 모호 -> 개선 ..."  # (AI 응답 가정)
    print("Plan:", plan_response)
    # Step 2: 계획에 따른 코드 수정
    code_request = f"위 계획에 따라 코드를 수정하세요:\n{plan_response}"
    code_response = "# 수정된 코드 예시\n def A(): ...\n"  # (AI 응답 가정 - 코드 조각)
    print("Code Draft:", code_response[:30], "...")
    # Step 3: 테스트 작성
    test_request = "위 수정된 코드에 대한 단위 테스트 코드를 작성하세요."
    test_response = "# 테스트 코드 예시\n def test_a(): ...\n"  # (AI 응답 가정)
    print("Test Draft:", test_response[:30], "...")
    # (각 단계 응답은 검토 후 실제 코드베이스에 적용하거나 필요 시 수정하여 재요청)
    
# 단위 테스트: 템플릿 및 체이닝 함수 작동 확인
if __name__ == "__main__":
    prompt = create_api_prompt("/items/search")
    assert "FastAPI" in prompt and "endpoint" in prompt, "Prompt template formatting issue"
    print(prompt.splitlines()[0])  # Expected output: [시스템 맥락]
    chain_prompts_for_refactoring()
```

위 코드에서 `prompt_templates.py` 모듈은 **프롬프트 템플릿**을 관리하고, `create_api_prompt` 함수는 특정 엔드포인트 작업에 대한 프롬프트를 생성합니다. 이 템플릿은 시스템 맥락과 요구사항을 구조화하여 제공함으로써, AI가 **명확한 조건** 하에서 코드를 작성하도록 돕습니다. 또한 `chain_prompts_for_refactoring()` 함수는 계획 → 코드 수정 → 테스트 작성의 **프롬프트 체인** 예시를 보여줍니다. 실제 상황에서는 `openai.ChatCompletion.create(...)` 등을 각 단계에서 호출하여 AI 응답을 받고, 사람이 그 응답을 검토한 뒤 다음 단계로 넘어가게 됩니다.

IndyDevDan이 강조하듯, 이러한 **맥락 제공과 세분화된 지시**는 AI 코딩 활용의 핵심 모범사례입니다. 개발자가 프로젝트 구조를 완전히 이해하고 요약해 AI에게 전달하면, AI는 모호한 지시 없이도 정확한 코드를 제안할 수 있습니다. 또한 작업 단위를 작게 쪼개면 오류 발생 시 원인 파악이 쉽고 수정 지시도 용이하여, **AI와의 상호작용 품질**이 크게 향상됩니다. 마지막으로, 이렇게 생성된 코드에 대해 사람 개발자가 리뷰 및 테스트를 거침으로써, AI의 생산성을 극대화하면서도 **통제와 책임**을 유지할 수 있습니다. 결과적으로 팔란티어 팀은 AI 에이전트를 올바르게 활용하여 **개발 속도와 품질** 두 마리 토끼를 잡을 수 있을 것입니다.

## 추가 개선 제안 및 향후 권고

마지막으로, 위 작업지시서의 구현을 바탕으로 추가로 고려할 만한 **개선 여지**와 **향후 권장 사항**을 정리합니다:

* **환경 설정 및 보안 강화:** 현재 예시 코드에서는 API 키 등을 평문으로 `.env`에 두고 사용하지만, 실제 운영 환경에서는 **비밀 관리 서비스**(예: AWS Secrets Manager, HashiCorp Vault 등)를 도입하고 설정 파일을 분리하는 것이 바람직합니다. 또한 OpenAI/Pinecone 등 외부 API 호출 시 **요금 및 속도 제한 관리** 로직(예: rate limit 모듈)을 추가하여 예기치 않은 과금이나 서비스 거부를 예방할 필요があります.

* **성능 및 스케일 업:** 멀티에이전트 오케스트레이션을 현재는 하나의 프로세스 내 스레드로 시뮬레이션했지만, 작업 부하가 크거나 병렬 수준을 높이려면 **프로세스 풀이나 비동기 I/O**로 전환을 검토해야 합니다. Python GIL로 인해 CPU 바운드 작업은 스레드로 무한 확장하기 어렵습니다. 또한 Orchestrator의 공유 메모리는 단일 프로세스 기준으로 설계되었는데, 에이전트를 **분산된 환경**(예: 여러 컨테이너 혹은 머신)에서 동작시키려면 **Redis** 같은 외부 메모리나 **메시지 브로커**를 도입해 상태와 메시지를 공유하도록 개선해야 합니다.

* **에이전트 오류 대응 전략:** 실제 운영 시에는 에이전트 중 하나라도 오류로 중단되면 Orchestrator가 이를 인지해 **해당 에이전트를 재시작**하거나 개발자에게 알리는 메커니즘이 필요합니다. 현재 코드 예시에는 없지만, 구현 시 `thread.is_alive()` 체크를 통해 죽은 스레드를 감지하고, 실패한 작업은 `Memory.logs`에 기록 후 Orchestrator가 **재시도 작업**을 스케줄링하는 방안을 권장합니다. 사람이 개입해야 할 오류의 경우, Slack/이메일 알림을 보내도록 연동하면 좋습니다.

* **고급 프레임워크 도입 검토:** 앞서 언급한 LangChain의 에이전트 체인, Microsoft **AutoGen**, OpenAI의 **Function Calling** 기능 등은 멀티에이전트 시스템 구축을 편리하게 해주는 도구들입니다. 팔란티어 프로젝트가 더 복잡해지면, 처음부터 모든 것을 자체 구현하기보다 이러한 **범용 프레임워크**를 도입하여 **신뢰성과 유지보수성**을 확보하는 것이 좋습니다. 예를 들어 AutoGen의 `Commander/Worker` 패턴이나, LangChain의 각종 툴 연동을 활용하면 코드 양을 줄이고 커뮤니티에서 검증된 방식을 취할 수 있습니다.

* **장기 학습 및 메모리 고도화:** Reflection 루프에서 누적되는 교훈들은 현재 메모리 리스트에 저장되지만, 이를 **벡터 임베딩으로 변환해 영구 저장**해두면 향후 유사한 상황 발생 시 검색하여 참고할 수 있습니다. 또한 일정 주기마다 (예: 분기별) 교훈 데이터를 활용해 **에이전트의 프롬프트나 정책을 업데이트**하거나, 가능하면 LLM 자체를 해당 데이터를 포함해 **파인튜닝**하는 것도 고려해볼 만 합니다. 팔란티어같이 장기간 운용되는 시스템에서는 이런 **지식 축적**이 시간이 지날수록 큰 가치가 되므로, 초기 단계부터 설계에 넣어 두면 좋습니다.

* **실시간 문서화 및 사용자 가이드:** 문서 자동화 측면에서, 앞서 도입한 Pydantic 기반 JSON Schema 생성 외에 \*\*FastAPI의 자동 문서 (Swagger/OpenAPI)\*\*를 사용자 안내용으로 활용하고, 더 나아가 \*\*문서 담당 에이전트(Scribe)\*\*를 두어 새로운 기능 추가 시마다 README나 Wiki를 업데이트하게 할 수 있습니다. 예를 들어 코드 리포지토리에 변경이 생기면, CI 파이프라인에서 변경 내역을 요약하고 관련 문서를 보충하는 작업을 AI 에이전트가 수행하도록 스크립트를 짤 수 있습니다. 이렇게 하면 프로젝트 이해관계자들에게 항상 최신 문서를 제공하고, 개발자도 문서 업데이트 부담을 줄일 수 있습니다.

以上의 개선안들을 참고하여, 팔란티어 프로젝트의 AI 에이전트 기반 개발을 지속적으로 발전시킬 수 있습니다. 궁극적으로 목표는 **AI 에이전트 팀**이 인간 개발자와 협업하여 빠르고 안정적으로 프로젝트를 성장시키는 것입니다. 이번 작업지시서에서 다룬 **환경 설정**부터 **문서 정리**, **AIP 통합**, **오케스트레이션**, **자가개선**, **프롬프트 전략**에 이르는 핵심 개선 사항들을 구현함으로써, 팔란티어 프로젝트가 한 단계 도약하리라 기대합니다.

---